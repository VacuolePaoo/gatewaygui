# Cross-compilation configuration

# Android targets
[target.aarch64-linux-android]
linker = "aarch64-linux-android21-clang"

[target.armv7-linux-androideabi]
linker = "armv7a-linux-androideabi21-clang"

[target.i686-linux-android]
linker = "i686-linux-android21-clang"
# Workaround for CPU feature detection issues
rustflags = [
  "-C", "link-arg=-Wl,--defsym=__cpu_indicator_init=0",
  "-C", "link-arg=-Wl,--defsym=__cpu_model=0"
]

[target.x86_64-linux-android]
linker = "x86_64-linux-android21-clang"
# Workaround for CPU feature detection issues
rustflags = [
  "-C", "link-arg=-Wl,--defsym=__cpu_indicator_init=0",
  "-C", "link-arg=-Wl,--defsym=__cpu_model=0"
]

# Linux ARM targets
[target.aarch64-unknown-linux-gnu]
linker = "aarch64-linux-gnu-gcc"

[target.armv7-unknown-linux-gnueabihf]
linker = "arm-linux-gnueabihf-gcc"

# Build optimization
[build]
jobs = 4

# Environment variables
[env]
ANDROID_NDK_ROOT = { value = "", relative = false }
# 设置测试默认使用单线程以避免竞态条件
RUST_TEST_THREADS = "1"